<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <style>
    body {
      margin: 0;
    }

    #demo-canvas {
      position: absolute;
    }
  </style>
  <script type="module">
    import init, { render, mouse_down, mouse_up, mouse_move } from './bindgen_fractal.js';
    async function init_this() {
      const wasm_exports = await init();

      // function renderToCanvas(canvas) {
      //   const { width, height } = canvas;
      //   const start = performance.now();
      //   const ctx = canvas.getContext('2d');
      //   const elapsed = performance.now() - start;
      //   console.log(`Rendered ${width * height} samples in ${elapsed}ms using ${wasm_exports.memory.buffer.byteLength / 1000000}M`);
      // }

      const canvas = document.getElementById("demo-canvas");
      
      canvas.addEventListener("mousedown", () => {
        const {width,height} = getSize();
        mouse_move(e.offsetX/width, e.offsetY/height);;
      });
      canvas.addEventListener("mouseup", () => {
        mouse_up();
      });
      canvas.addEventListener("mousemove", (e) => {
        const {width,height} = getSize();
        mouse_move(e.offsetX/width, e.offsetY/height);
      });

      const body = document.getElementsByTagName('body')[0];
      function getSize() {
        return {
          width: window.innerWidth,
          height: window.innerHeight
        }
      }
      let lastW, lastH;
      setInterval(() => {
        const { width, height } = getSize();
        if (lastW !== width || lastH !== height) {
          canvas.width = lastW = width;
          canvas.height = lastH = height;
          renderToCanvas(canvas);
        }
      }, 100);
    }

    init_this();
  </script>
</head>

<body>
  <canvas id="demo-canvas"></canvas>
</body>

</html>